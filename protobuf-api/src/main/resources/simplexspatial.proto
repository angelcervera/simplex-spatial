syntax = "proto3";

option java_multiple_files = true;
option java_package = "com.simplexportal.spatial.api.data";

package com.simplexportal.spatial.api;

service DataService {
    rpc AddNode (AddNodeCmd) returns (Done);
    rpc AddWay (AddWayCmd) returns (Done);
    rpc ExecuteBatch (ExecuteBatchCmd) returns (Done);
    rpc StreamCommands (stream ExecuteCmd) returns (Done);
    rpc StreamBatchCommands (stream ExecuteBatchCmd) returns (stream Done);
    rpc GetMetrics (GetMetricsCmd) returns (Metrics);
}

message Done { }

message AddNodeCmd {
    uint64 id = 1;
    double lon = 2;
    double lat = 3;
    map<string, string> attributes = 4;
}

message AddWayCmd {
    uint64 id = 1;
    repeated uint64 nodeIds = 2;
    map<string, string> attributes = 3;
}

message ExecuteCmd {
    oneof Command {
        AddNodeCmd node = 1;
        AddWayCmd way = 2;
    }
}

message ExecuteBatchCmd {
    repeated ExecuteCmd commands = 1;
}

message GetMetricsCmd { }

message Metrics {
    uint64 ways = 1;
    uint64 nodes = 2;
}

